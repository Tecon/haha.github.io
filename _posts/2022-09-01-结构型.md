---
title:  "结构型模式"
author:
  name: liuhe
  link: https://tecon.github.io
date:  2022-09-01 09:49:49 +0800
categories: [work, 利其器]
tags: [design pattern]
toc: false
---


#### 适配器模式

​		通过适配器使得拥有不兼容接口的类完成无缝对接，适配器将目标类和适配者解耦，增加了类的透明性和可复用性。适配器有类适配器和对象适配器。类适配器通过继承目标类并实现适配者实现；对象适配器通过对象组和实现适配。适配器的一大问题是过多的应用容易造成逻辑意义的混淆，大大降低了代码的可读性。**对于类适配器，当需要适配的类增多时，实际生产中一般通过对于不同的目标类使用策略模式达到无缝对接。对于对象适配器，当需要适配的对象急剧增多时，一般通过增加新的对象适配器，并划分层次、职责来达到逻辑清晰、方便维护的目的，如果新增对象适配器依然无法有效解决（适配对象实在太多了），往往需要在逻辑架构上进行调整，并引入类似策略模式、工厂模式、模板模式等拆分相应的对象适配器，如果这样还是不行，那说明整个架构有问题啊，核心代码都堆到一起了，需要好好考虑下当前这种方式是否合适了**

#### 桥接模式

​		将抽象部分与实现部分分离，使他们都可以独立的变化。显然，Java的多态是实现桥接模式非常好的手段，上述中抽象工厂的子类的实现即是桥接模式的应用

#### 组合模式

​		显然，无论是自定义多个属性或者维护一个对象集合，都是组合模式的运用。组合模式使得client对单个对象和组合对象的使用具有一致性。

#### 装饰者模式

​		通过对现有的类进行包装，以达到不修改已有类的基础上增加新的功能的目的。**在实际生产中，在包装RPC接口中广泛使用，通过wrapper的方式，在不修改已有接口的情况下，对二方包的rpc接口添加异常封装、降级等功能**	

#### 门面模式

​		通过为一个复杂的子系统提供对外的简单门面接口，屏蔽子系统的复杂性，降低各系统之间的依赖。**实际生产中，外观模式在上述装饰者模式应用场景中，再往上靠近业务的一层中使用比较普遍**

#### 享元模式

​		运用共享技术有效地支持大量细粒度的对象。**最常见的就是Java中的Integer类持有0-128的数字对象，以加快valueOf(int)方法的访问速度；实际生产中比较常见的是初始化一些固定的（不多，因为这种情况更合理的做法是放在配置中心去）或者是一次性的数据（嗯，这个修数据或者跑数据的时候就比较常见了，哈哈哈）**

#### 代理模式

​		通过为其他对象提供一种代理以实现访问当前对象。

Java代理模式的实现分为静态代理和动态代理（分为**jdk动态代理**和**cglib动态代理**）

静态代理在编译前写好静态代理类代码，编译时将代理类变成class文件，一旦修改接口，则目标对象和代理对象需要一起修改

**jdk动态代理在运行时动态生成代理类字节码（调用时使用反射）**并加载到JVM中，接口变更，仅需修改目标对象。实现InvocationHandler接口即可使用Proxy类动态生成代理，并实现代理调用。由于**动态生成的代理类继承了Proxy类，java又是单继承的，所以动态生成的类如果想和被代理的类关联起来，只能通过implement接口的形式，顾使用jdk动态代理时被代理类必须是实现了某一个接口的类**。

**cglib使用ASM技术生成代理类字节码的方式实现代理类的动态生成**，这种方式由于直接操作字节码，顾没有implement接口的类也可以被代理，但是由于它生成的是被代理类的子类，顾对于final类和方法不生效，调用代理类时通过FastClass方法索引调用，比反射略快，但是方法过多时switch case效率如何有待测试。

JDK动态代理是委托机制，在动态生成的代理类中委托InvocationHandler通过反射去调用被代理类的实现方法。CGLib则使用的继承机制，被代理类和代理类是继承关系，所以代理类是可以赋值给被代理类的，如果被代理类有接口，那么代理类也可以赋值给接口

![image-20220816101814944](/2022/09/upgit_20220901_1661996677.png)

#### 参考链接

[代理模式](https://juejin.cn/post/7011357346018361375)

[JDK动态代理与CGLib对比](https://www.cnblogs.com/zjfjava/p/13919437.html)

[java代理模式](https://segmentfault.com/a/1190000011291179)
